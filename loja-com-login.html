<!DOCTYPE html><html lang="pt-BR"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Compra Funcionário GP7 Teixeira</title><script src="https://cdn.tailwindcss.com"></script><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"><script src="https://unpkg.com/@phosphor-icons/web"></script><style> body { font-family: 'Inter', sans-serif; } .hidden { display: none; } .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; } :root { --brand-primary: #36208a; --brand-primary-hover: #29186a; --brand-secondary: #5a43b3; } </style></head><body class="bg-gray-100"><div id="auth-section" class="fixed inset-0 flex items-center justify-center z-50"><div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md"><div id="login-container"><div class="flex justify-center mb-6"><i class="ph-bold ph-storefront text-5xl" style="color: var(--brand-primary);"></i></div><h2 class="text-2xl font-bold mb-6 text-center">Login - GP7 Teixeira</h2><form id="login-form" class="space-y-4"><div><label for="login-email" class="block text-sm font-medium">Email</label><input type="email" id="login-email" required class="mt-1 w-full p-2 border rounded"></div><div><label for="login-password" class="block text-sm font-medium">Senha</label><div class="relative"><input type="password" id="login-password" required class="w-full p-2 border rounded pr-10"><button type="button" id="toggle-login-password" class="absolute inset-y-0 right-0 pr-3 flex items-center"><i class="ph-bold ph-eye-slash"></i></button></div></div><button type="submit" class="w-full text-white font-bold py-2 rounded" style="background-color: var(--brand-primary);">Entrar</button><p id="login-error" class="text-red-500 text-sm text-center hidden">Email ou senha inválidos.</p></form><p class="mt-4 text-center text-sm">Não tem conta? <a href="#" id="show-register" class="font-medium" style="color: var(--brand-primary);">Registre-se</a></p><div class="mt-6 pt-4 border-t text-center"><a href="admin-login.html" class="text-xs text-gray-500 hover:underline" style="color: var(--brand-secondary);">Acesso de Administrador</a></div></div><div id="register-container" class="hidden"><h2 class="text-2xl font-bold mb-6 text-center">Criar Conta</h2><form id="register-form" class="space-y-4"><div><label for="register-name" class="block text-sm font-medium">Nome</label><input type="text" id="register-name" required class="mt-1 w-full p-2 border rounded"></div><div><label for="register-email" class="block text-sm font-medium">Email</label><input type="email" id="register-email" required class="mt-1 w-full p-2 border rounded"></div><div><label for="register-cpf" class="block text-sm font-medium">CPF</label><input type="text" id="register-cpf" required class="mt-1 w-full p-2 border rounded" placeholder="000.000.000-00" maxlength="14"></div><div><label for="register-role" class="block text-sm font-medium">Função</label><input type="text" id="register-role" required class="mt-1 w-full p-2 border rounded"></div><div><label for="register-password" class="block text-sm font-medium">Senha</label><div class="relative"><input type="password" id="register-password" required class="w-full p-2 border rounded pr-10"><button type="button" id="toggle-register-password" class="absolute inset-y-0 right-0 pr-3 flex items-center"><i class="ph-bold ph-eye-slash"></i></button></div></div><button type="submit" class="w-full text-white font-bold py-2 rounded" style="background-color: var(--brand-secondary);">Registrar</button><p id="register-error" class="text-red-500 text-sm text-center hidden"></p></form><p class="mt-4 text-center text-sm">Já tem uma conta? <a href="#" id="show-login" class="font-medium" style="color: var(--brand-primary);">Faça login</a></p></div></div></div><div id="store-section" class="hidden"><div class="container mx-auto max-w-7xl p-4"><header class="flex justify-between items-center pb-6 border-b mb-6"><div class="flex items-center space-x-3"><i class="ph-bold ph-storefront text-3xl" style="color: var(--brand-primary);"></i><h1 class="text-3xl font-bold">Compra Funcionário GP7 TX</h1></div><div class="flex items-center space-x-4"><div id="user-info" class="text-right hidden sm:block"></div><button id="account-btn" class="text-gray-600 hover:text-purple-800 flex items-center space-x-2"><i class="ph-bold ph-user-circle text-2xl"></i><span class="hidden md:inline">Minha Conta</span></button><button id="logout-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-3 rounded-lg flex items-center space-x-2"><i class="ph-bold ph-sign-out text-xl"></i><span class="hidden md:inline">Sair</span></button><div class="relative"><i class="ph-bold ph-shopping-cart-simple text-3xl"></i><span id="cart-count" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center">0</span></div></div></header><main class="grid grid-cols-1 lg:grid-cols-3 gap-8"><section class="lg:col-span-2"><h2 class="text-xl font-semibold mb-4">Nossos Produtos</h2><div id="product-list" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6"></div></section><aside class="lg:col-span-1"><div class="bg-white rounded-lg shadow-md p-6 sticky top-8"><h2 class="text-xl font-semibold mb-4 flex items-center space-x-2"><i class="ph-bold ph-shopping-cart"></i><span>Seu Pedido</span></h2><div id="checkout-user-info" class="mb-6 border-b pb-4 space-y-2"></div><h3 class="text-md font-semibold mb-3">Itens no Carrinho</h3><div id="cart-items" class="space-y-3 mb-4 max-h-60 overflow-y-auto pr-2"><p id="empty-cart-message" class="text-gray-500 text-center py-4">Carrinho vazio.</p></div><div class="border-t pt-4"><div class="flex justify-between items-center font-bold text-lg"><span>Total:</span><span id="cart-total">R$ 0,00</span></div></div><div class="mt-6"><button id="finalize-order-btn" class="w-full text-white font-bold py-3 rounded-lg flex items-center justify-center space-x-2" style="background-color: var(--brand-primary);"><i class="ph-bold ph-check-circle"></i><span>Finalizar Pedido</span></button><p id="shop-locked-message" class="hidden mt-2 text-center text-sm text-red-600 bg-red-100 p-2 rounded-md"></p></div></div></aside></main></div></div><div id="order-confirmed-section" class="hidden"><div class="min-h-screen flex items-center justify-center p-4"><div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-2xl text-center"><i class="ph-bold ph-check-circle text-6xl" style="color: var(--brand-primary);"></i><h2 class="text-3xl font-bold mt-4">Pedido Confirmado!</h2><p class="text-gray-600 mt-2">Obrigado pela sua compra, <span id="confirm-user-name"></span>! Seu pedido foi registrado.</p><div class="text-left bg-gray-50 p-6 rounded-lg my-6 border"><h3 class="font-semibold mb-3">Resumo do Pedido</h3><div id="confirm-order-details" class="space-y-2"></div><div class="border-t mt-4 pt-4 flex justify-between font-bold text-lg"><span>Total:</span><span id="confirm-order-total"></span></div></div><button id="back-to-store-btn" class="w-full text-white font-bold py-3 rounded-lg" style="background-color: var(--brand-primary);">Voltar para a Loja</button></div></div></div><div id="account-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"><div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-lg relative"><button id="close-account-modal" class="absolute top-4 right-4"><i class="ph-bold ph-x text-2xl"></i></button><h2 class="text-2xl font-bold mb-6">Minha Conta</h2><div id="main-account-view"><div id="account-details" class="p-4 bg-gray-50 rounded-lg border space-y-2"></div><button id="show-my-orders-btn" class="mt-4 w-full bg-gray-600 text-white font-bold py-2 rounded-lg flex items-center justify-center space-x-2"><i class="ph-bold ph-archive"></i><span>Ver Meus Pedidos</span></button><h3 class="text-lg font-semibold mt-6 mb-3">Alterar Senha</h3><form id="password-change-form" class="space-y-3"><div><label for="current-password" class="block text-sm font-medium">Senha Atual</label><input type="password" id="current-password" required class="mt-1 w-full p-2 border rounded"></div><div><label for="new-password" class="block text-sm font-medium">Nova Senha</label><input type="password" id="new-password" required class="mt-1 w-full p-2 border rounded"></div><div><label for="confirm-password" class="block text-sm font-medium">Confirmar</label><input type="password" id="confirm-password" required class="mt-1 w-full p-2 border rounded"></div><button type="submit" class="w-full text-white font-bold py-2 rounded" style="background-color: var(--brand-secondary);">Salvar</button></form><p id="password-change-feedback" class="text-sm text-center mt-3"></p></div><div id="my-orders-view" class="hidden"><h3 class="text-lg font-semibold mb-3">Meus Pedidos</h3><div id="my-orders-list" class="space-y-3 max-h-96 overflow-y-auto"></div><button id="back-to-account-btn" class="mt-4 w-full bg-gray-200 font-bold py-2 rounded-lg">Voltar</button></div></div></div><script type="module">import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, updatePassword, EmailAuthProvider, reauthenticateWithCredential } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";import { getFirestore, doc, setDoc, getDoc, collection, onSnapshot, addDoc, query, where } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";const firebaseConfig = {apiKey: "AIzaSyDqZ3USsiJvToYb60cJHyNonyLR_8KJ92g",authDomain: "gp7-compra-funcionario.firebaseapp.com",projectId: "gp7-compra-funcionario",storageBucket: "gp7-compra-funcionario.appspot.com",messagingSenderId: "1077010915354",appId: "1:1077010915354:web:f571a10974fd46cf3471a3",measurementId: "G-VFSLE17G9Z"};const app = initializeApp(firebaseConfig);const auth = getAuth(app);const db = getFirestore(app);let allProducts = [], products = [], currentUser = null, currentUserData = null, cart = [];async function handleRegister(e) { e.preventDefault(); const name = document.getElementById('register-name').value.trim(), email = document.getElementById('register-email').value.trim(), cpf = document.getElementById('register-cpf').value.trim(), role = document.getElementById('register-role').value.trim(), password = document.getElementById('register-password').value, errorP = document.getElementById('register-error'); errorP.classList.add('hidden'); if (!name || !email || !cpf || !role || !password) { errorP.textContent = 'Todos os campos são obrigatórios.'; errorP.classList.remove('hidden'); return; } try { const userCredential = await createUserWithEmailAndPassword(auth, email, password); const user = userCredential.user; await setDoc(doc(db, "users", user.uid), { name, email, cpf, role, isLocked: false }); } catch (error) { errorP.textContent = 'Erro ao criar conta: ' + error.message; errorP.classList.remove('hidden'); } } async function handleLogin(e) { e.preventDefault(); const email = document.getElementById('login-email').value.trim(), password = document.getElementById('login-password').value, errorP = document.getElementById('login-error'); errorP.classList.add('hidden'); try { await signInWithEmailAndPassword(auth, email, password); } catch (error) { errorP.textContent = 'Email ou senha inválidos.'; errorP.classList.remove('hidden'); } } function handleLogout() { auth.signOut(); } function togglePassword(inputId, iconElement) { const input = document.getElementById(inputId), isPwd = input.type === 'password'; input.type = isPwd ? 'text' : 'password'; iconElement.innerHTML = `<i class="ph-bold ${isPwd ? 'ph-eye' : 'ph-eye-slash'}"></i>`; } async function handlePasswordChange(e) { e.preventDefault(); const current = document.getElementById('current-password').value, newPwd = document.getElementById('new-password').value, confirm = document.getElementById('confirm-password').value; if (newPwd !== confirm) { showPwdFeedback('As novas senhas não coincidem.', 'error'); return; } const user = auth.currentUser; const credential = EmailAuthProvider.credential(user.email, current); try { await reauthenticateWithCredential(user, credential); await updatePassword(user, newPwd); showPwdFeedback('Senha alterada com sucesso!', 'success'); document.getElementById('password-change-form').reset(); } catch (error) { showPwdFeedback('Senha atual incorreta.', 'error'); } } function showPwdFeedback(msg, type) { const fb = document.getElementById('password-change-feedback'); fb.textContent = msg; fb.className = `text-sm text-center mt-3 ${type === 'success' ? 'text-green-600' : 'text-red-600'}`; } function showStoreView() { document.getElementById('order-confirmed-section').classList.add('hidden'); document.getElementById('auth-section').classList.add('hidden'); document.getElementById('store-section').classList.remove('hidden'); document.getElementById('user-info').innerHTML = `<p class="font-semibold">${currentUserData.name.split(' ')[0]}</p><p class="text-sm text-gray-600">${currentUser.email}</p>`; document.getElementById('checkout-user-info').innerHTML = `<h3 class="text-md font-semibold">Dados do Comprador</h3><p><b>Nome:</b> ${currentUserData.name}</p><p><b>CPF:</b> ${currentUserData.cpf}</p><p><b>Função:</b> ${currentUserData.role}</p>`; document.getElementById('account-details').innerHTML = `<p><b>Nome:</b> ${currentUserData.name}</p><p><b>Email:</b> ${currentUser.email}</p><p><b>CPF:</b> ${currentUserData.cpf}</p><p><b>Função:</b> ${currentUserData.role}</p>`; initializeStore(); } function renderMyOrders() { const list = document.getElementById('my-orders-list'); const q = query(collection(db, 'orders'), where("user.uid", "==", currentUser.uid)); onSnapshot(q, snapshot => { const myOrders = snapshot.docs.map(d => d.data()); list.innerHTML = ''; if (myOrders.length === 0) { list.innerHTML = '<p class="text-gray-500 text-center">Você ainda não fez nenhum pedido.</p>'; return; } const statusStyles = { 'Pendente': 'bg-yellow-100 text-yellow-800', 'Efetuado': 'bg-green-100 text-green-800', 'Devolvido': 'bg-red-100 text-red-800' }; myOrders.sort((a,b) => new Date(b.date) - new Date(a.date)).forEach(order => { const total = order.items.reduce((sum, item) => sum + (item.price * item.quantity), 0); const el = document.createElement('div'); el.className = 'border rounded-lg p-3'; el.innerHTML = `<div class="flex justify-between items-start"><div><p class="font-semibold">Pedido de ${new Date(order.date).toLocaleDateString('pt-BR')}</p><p class="text-sm text-gray-600">Total: R$ ${total.toFixed(2).replace('.', ',')}</p></div><span class="text-xs font-medium px-2.5 py-0.5 rounded-full ${statusStyles[order.status] || 'bg-gray-200'}">${order.status}</span></div><ul class="text-sm mt-2 list-disc list-inside text-gray-700">${order.items.map(item => `<li>${item.quantity}x ${item.name}</li>`).join('')}</ul>`; list.appendChild(el); }); }); } function renderProducts() { const list = document.getElementById('product-list'); list.innerHTML = ''; if (products.length === 0) { list.innerHTML = `<p class="lg:col-span-3 text-center text-gray-500 p-8">Nenhum produto disponível.</p>`; return; } products.forEach(p => { const card = document.createElement('div'); card.className = 'bg-white rounded-lg shadow-md overflow-hidden'; card.innerHTML = `<img src="${p.image}" alt="${p.name}" class="w-full h-48 object-cover"><div class="p-4"><h3 class="text-lg font-semibold">${p.name}</h3><p class="text-sm text-gray-500 mb-2">Cód: ${p.code}</p><p class="text-xl font-bold">R$ ${Number(p.price).toFixed(2).replace('.', ',')}</p><button data-id="${p.id}" class="add-to-cart-btn w-full mt-3 font-bold py-2 rounded text-white" style="background-color: var(--brand-secondary);">Adicionar</button></div>`; list.appendChild(card); }); } function updateCartUI() { const list = document.getElementById('cart-items'); list.innerHTML = ''; if (cart.length === 0) { list.innerHTML = `<p id="empty-cart-message" class="text-gray-500 text-center py-4">Carrinho vazio.</p>`; } else { cart.forEach(item => { const el = document.createElement('div'); el.className = 'flex items-center justify-between bg-gray-50 p-2 rounded'; el.innerHTML = `<div class="flex-grow pr-2"><p class="font-semibold text-sm">${item.name}</p><p class="text-xs">R$ ${Number(item.price).toFixed(2).replace('.', ',')}</p></div><div class="flex items-center space-x-2"><button data-id="${item.id}" class="decrement-btn bg-gray-200 rounded-full h-6 w-6">-</button><span>${item.quantity}</span><button data-id="${item.id}" class="increment-btn bg-gray-200 rounded-full h-6 w-6">+</button><button data-id="${item.id}" class="remove-btn text-red-500"><i class="ph-bold ph-trash"></i></button></div>`; list.appendChild(el); });} document.getElementById('cart-count').textContent = cart.reduce((s, i) => s + i.quantity, 0); document.getElementById('cart-total').textContent = `R$ ${cart.reduce((s, i) => s + (i.price * i.quantity), 0).toFixed(2).replace('.', ',')}`; } function addToCart(id) { const p = products.find(p => p.id == id), item = cart.find(i => i.id == id); item ? item.quantity++ : cart.push({ ...p, quantity: 1 }); updateCartUI(); } function handleCartActions(e) { const target = e.target.closest('button'); if (!target) return; const id = target.dataset.id, item = cart.find(i => i.id == id); if (target.matches('.increment-btn')) { if (item) item.quantity++; } else if (target.matches('.decrement-btn')) { if (item) { item.quantity--; if (item.quantity === 0) cart = cart.filter(i => i.id != id); }} else if (target.matches('.remove-btn')) { cart = cart.filter(i => i.id != id); } updateCartUI(); } async function finalizeOrder() { const btn = document.getElementById('finalize-order-btn'); if (cart.length === 0) { return; } btn.disabled = true; btn.innerHTML = `<i class="ph-bold ph-circle-notch animate-spin"></i><span class="ml-2">Salvando...</span>`; const newOrder = { user: { uid: currentUser.uid, name: currentUserData.name, email: currentUser.email, cpf: currentUserData.cpf, role: currentUserData.role }, items: cart, date: new Date().toISOString(), status: 'Pendente' }; await addDoc(collection(db, 'orders'), newOrder); document.getElementById('store-section').classList.add('hidden'); document.getElementById('order-confirmed-section').classList.remove('hidden'); document.getElementById('confirm-user-name').textContent = currentUserData.name.split(' ')[0]; document.getElementById('confirm-order-details').innerHTML = newOrder.items.map(item => `<div class="flex justify-between text-sm"><span>${item.quantity}x ${item.name}</span><span>R$ ${(item.price * item.quantity).toFixed(2).replace('.', ',')}</span></div>`).join(''); document.getElementById('confirm-order-total').textContent = `R$ ${newOrder.items.reduce((s, i) => s + (i.price * i.quantity), 0).toFixed(2).replace('.', ',')}`; cart = []; updateCartUI(); btn.disabled = false; btn.innerHTML = `<i class="ph-bold ph-check-circle"></i><span>Finalizar Pedido</span>`; } async function checkLocks() { const settingsRef = doc(db, 'settings', 'shopLock'); const settingsSnap = await getDoc(settingsRef); const isShopLocked = settingsSnap.exists() && settingsSnap.data().isLocked; const isUserLocked = currentUserData.isLocked || false; const finalizeBtn = document.getElementById('finalize-order-btn'); const lockedMsg = document.getElementById('shop-locked-message'); if (isShopLocked || isUserLocked) { finalizeBtn.disabled = true; finalizeBtn.classList.add('opacity-50', 'cursor-not-allowed'); lockedMsg.classList.remove('hidden'); lockedMsg.textContent = isUserLocked ? "Sua conta está bloqueada para compras. Fale com o administrador." : "As compras estão temporariamente bloqueadas."; } else { finalizeBtn.disabled = false; finalizeBtn.classList.remove('opacity-50', 'cursor-not-allowed'); lockedMsg.classList.add('hidden'); } } function initializeStore() { onSnapshot(collection(db, 'products'), snapshot => { allProducts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })); products = allProducts.filter(p => !p.hidden); renderProducts(); }); updateCartUI(); checkLocks(); } onAuthStateChanged(auth, async (user) => { if (user) { currentUser = user; const userDocRef = doc(db, "users", user.uid); const userDocSnap = await getDoc(userDocRef); if (userDocSnap.exists()) { currentUserData = userDocSnap.data(); showStoreView(); onSnapshot(userDocRef, (doc) => { currentUserData = doc.data(); checkLocks(); }); } else { auth.signOut(); } } else { document.getElementById('store-section').classList.add('hidden'); document.getElementById('auth-section').classList.remove('hidden'); } }); document.addEventListener('DOMContentLoaded', () => { document.querySelector('#show-register').addEventListener('click', () => { document.getElementById('login-container').classList.add('hidden'); document.getElementById('register-container').classList.remove('hidden'); }); document.querySelector('#show-login').addEventListener('click', () => { document.getElementById('register-container').classList.add('hidden'); document.getElementById('login-container').classList.remove('hidden'); }); document.querySelector('#login-form').addEventListener('submit', handleLogin); document.querySelector('#register-form').addEventListener('submit', handleRegister); document.querySelector('#logout-btn').addEventListener('click', handleLogout); document.querySelector('#account-btn').addEventListener('click', () => { document.getElementById('main-account-view').classList.remove('hidden'); document.getElementById('my-orders-view').classList.add('hidden'); document.getElementById('account-modal').classList.remove('hidden'); }); document.querySelector('#close-account-modal').addEventListener('click', () => document.getElementById('account-modal').classList.add('hidden')); document.querySelector('#password-change-form').addEventListener('submit', handlePasswordChange); document.querySelector('#toggle-login-password').addEventListener('click', e => togglePassword('login-password', e.currentTarget)); document.querySelector('#toggle-register-password').addEventListener('click', e => togglePassword('register-password', e.currentTarget)); document.querySelector('#product-list').addEventListener('click', e => { const btn=e.target.closest('.add-to-cart-btn'); if(btn)addToCart(btn.dataset.id) }); document.querySelector('#cart-items').addEventListener('click', handleCartActions); document.querySelector('#finalize-order-btn').addEventListener('click', finalizeOrder); document.getElementById('register-cpf').addEventListener('input', e => { let v=e.target.value.replace(/\D/g,''); v=v.replace(/(\d{3})(\d)/,'$1.$2');v=v.replace(/(\d{3})(\d)/,'$1.$2');v=v.replace(/(\d{3})(\d{1,2})$/,'$1-$2');e.target.value=v; }); document.getElementById('show-my-orders-btn').addEventListener('click', () => { renderMyOrders(); document.getElementById('main-account-view').classList.add('hidden'); document.getElementById('my-orders-view').classList.remove('hidden'); }); document.getElementById('back-to-account-btn').addEventListener('click', () => { document.getElementById('my-orders-view').classList.add('hidden'); document.getElementById('main-account-view').classList.remove('hidden'); }); document.getElementById('back-to-store-btn').addEventListener('click', () => showStoreView()); });</script></body></html>