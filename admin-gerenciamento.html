<!DOCTYPE html><html lang="pt-BR"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Gerenciamento - Lojinha</title><script src="https://cdn.tailwindcss.com"></script><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"><script src="https://unpkg.com/@phosphor-icons/web"></script><style> body { font-family: 'Inter', sans-serif; background-color: #f9fafb; } :root { --brand-primary: #36208a; } .hidden-product-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(255, 255, 255, 0.7); display: flex; align-items: center; justify-content: center; } .toggle-bg:after { content: ''; position: absolute; top: 2px; left: 2px; background: white; border-radius: 9999px; height: 1.25rem; width: 1.25rem; transition: transform 0.2s; } input:checked + .toggle-bg:after { transform: translateX(100%); } input:checked + .toggle-bg { background-color: #ef4444; } </style></head><body><div class="container mx-auto max-w-7xl p-4 sm:p-6 lg:p-8"><header class="flex justify-between items-center pb-6 border-b border-gray-200 mb-6"><div class="flex items-center space-x-3"><i class="ph-bold ph-wrench text-3xl" style="color: var(--brand-primary);"></i><h1 class="text-2xl sm:text-3xl font-bold text-gray-900">Gerenciamento</h1></div><a href="admin.html" class="font-semibold flex items-center space-x-2" style="color: var(--brand-primary);"><i class="ph-bold ph-arrow-left"></i><span>Voltar ao Painel</span></a></header><main class="space-y-12"><section><h2 class="text-2xl font-semibold mb-4 text-gray-800 border-b pb-2">Controlo da Loja</h2><div class="bg-white p-6 rounded-lg shadow-md"><div class="flex items-center justify-between"><div><h3 class="text-lg font-medium text-gray-900">Bloquear Compras (Geral)</h3><p class="text-sm text-gray-500">Ative para impedir que TODOS os novos pedidos sejam finalizados.</p></div><div class="flex items-center space-x-4"><span id="shop-lock-status" class="font-bold text-sm uppercase"></span><label for="shop-lock-toggle" class="flex items-center cursor-pointer"><div class="relative"><input type="checkbox" id="shop-lock-toggle" class="sr-only"><div class="toggle-bg bg-gray-200 border-2 border-transparent h-7 w-12 rounded-full"></div></div></label></div></div></div></section><section><h2 class="text-2xl font-semibold mb-4 text-gray-800 border-b pb-2">Gerenciar Produtos</h2><div class="grid grid-cols-1 md:grid-cols-3 gap-8"><div class="md:col-span-1"><div class="bg-white rounded-lg shadow-md p-6 sticky top-8"><h3 id="form-title" class="text-xl font-semibold mb-4">Adicionar Produto</h3><form id="product-form" class="space-y-4"><input type="hidden" id="product-id"><div><label for="product-name" class="block text-sm font-medium">Nome</label><input type="text" id="product-name" required class="mt-1 w-full p-2 border rounded"></div><div><label for="product-code" class="block text-sm font-medium">Código</label><input type="text" id="product-code" required class="mt-1 w-full p-2 border rounded"></div><div><label for="product-price" class="block text-sm font-medium">Preço</label><input type="number" step="0.01" id="product-price" required class="mt-1 w-full p-2 border rounded"></div><div><label for="product-image" class="block text-sm font-medium">URL da Imagem</label><input type="url" id="product-image" required class="mt-1 w-full p-2 border rounded" placeholder="https://..."></div><div class="flex space-x-2"><button type="submit" class="w-full bg-green-600 text-white font-bold py-2 rounded-lg">Salvar</button><button type="button" id="cancel-edit-btn" class="w-full bg-gray-500 text-white font-bold py-2 rounded-lg hidden">Cancelar</button></div></form></div></div><div class="md:col-span-2"><h3 class="text-xl font-semibold mb-4">Produtos Cadastrados</h3><div id="admin-product-list" class="space-y-4"></div></div></div></section><section><h2 class="text-2xl font-semibold mb-4 text-gray-800 border-b pb-2">Usuários Cadastrados</h2><div id="admin-user-list" class="bg-white rounded-lg shadow-md overflow-x-auto"></div></section></main></div><script type="module">import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";import { getFirestore, collection, onSnapshot, addDoc, doc, updateDoc, deleteDoc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";const firebaseConfig = {apiKey: "AIzaSyDqZ3USsiJvToYb60cJHyNonyLR_8KJ92g",authDomain: "gp7-compra-funcionario.firebaseapp.com",projectId: "gp7-compra-funcionario",storageBucket: "gp7-compra-funcionario.appspot.com",messagingSenderId: "1077010915354",appId: "1:1077010915354:web:f571a10974fd46cf3471a3",measurementId: "G-VFSLE17G9Z"};const app = initializeApp(firebaseConfig);const db = getFirestore(app);const productsCol = collection(db, 'products');const usersCol = collection(db, 'users');const settingsDoc = doc(db, 'settings', 'shopLock');function updateShopLockStatus(isLocked) { const statusText = document.getElementById('shop-lock-status'); if (isLocked) { statusText.textContent = 'BLOQUEADO'; statusText.className = 'font-bold text-sm uppercase text-red-600'; } else { statusText.textContent = 'LIBERADO'; statusText.className = 'font-bold text-sm uppercase text-green-600'; } } async function toggleShopLock() { const isLocked = document.getElementById('shop-lock-toggle').checked; await setDoc(settingsDoc, { isLocked: isLocked }); } function renderProducts(products) { const list = document.getElementById('admin-product-list'); list.innerHTML = ''; if (products.length === 0) { list.innerHTML = `<p class="text-center text-gray-500 p-8">Nenhum produto cadastrado.</p>`; return; } products.forEach(p => { const el = document.createElement('div'); el.className = 'bg-white rounded-lg shadow p-4 flex items-center space-x-4 relative'; el.innerHTML = `${p.hidden ? '<div class="hidden-product-overlay"><span class="bg-gray-800 text-white text-xs font-bold px-3 py-1 rounded-full">OCULTO</span></div>' : ''}<img src="${p.image}" alt="${p.name}" class="w-20 h-20 rounded object-cover"><div class="flex-grow"><p class="font-bold">${p.name}</p><p class="text-sm">Cód: ${p.code}</p><p class="text-sm">R$ ${Number(p.price).toFixed(2).replace('.', ',')}</p></div><div class="flex flex-col space-y-2"><button data-id="${p.id}" class="toggle-hide-btn bg-gray-500 text-white px-3 py-1 rounded text-sm flex items-center justify-center space-x-1">${p.hidden ? '<i class="ph-bold ph-eye"></i>' : '<i class="ph-bold ph-eye-slash"></i>'}<span>${p.hidden ? 'Mostrar' : 'Ocultar'}</span></button><button data-id="${p.id}" class="edit-btn bg-blue-500 text-white px-3 py-1 rounded text-sm">Editar</button><button data-id="${p.id}" class="delete-btn bg-red-500 text-white px-3 py-1 rounded text-sm">Remover</button></div>`; list.appendChild(el); }); } async function handleProductSubmit(e) { e.preventDefault(); const id = document.getElementById('product-id').value; const data = { name: document.getElementById('product-name').value, code: document.getElementById('product-code').value, price: parseFloat(document.getElementById('product-price').value), image: document.getElementById('product-image').value }; if (id) { await updateDoc(doc(db, 'products', id), data); } else { data.hidden = false; await addDoc(productsCol, data); } resetProductForm(); } async function toggleProductVisibility(id) { const productRef = doc(db, 'products', id); const productSnap = await getDoc(productRef); if (productSnap.exists()) { await updateDoc(productRef, { hidden: !productSnap.data().hidden }); } } async function editProduct(id) { const productRef = doc(db, 'products', id); const productSnap = await getDoc(productRef); if (productSnap.exists()) { const p = productSnap.data(); document.getElementById('form-title').textContent = "Editar Produto"; document.getElementById('product-id').value = productSnap.id; document.getElementById('product-name').value = p.name; document.getElementById('product-code').value = p.code; document.getElementById('product-price').value = p.price; document.getElementById('product-image').value = p.image; document.getElementById('cancel-edit-btn').classList.remove('hidden'); window.scrollTo(0, 0); } } async function deleteProduct(id) { if (confirm('Tem certeza?')) { await deleteDoc(doc(db, 'products', id)); } } function resetProductForm() { document.getElementById('product-form').reset(); document.getElementById('product-id').value = ''; document.getElementById('form-title').textContent = "Adicionar Produto"; document.getElementById('cancel-edit-btn').classList.add('hidden'); } function renderUsers(users) { const list = document.getElementById('admin-user-list'); list.innerHTML = ''; if (users.length === 0) { list.innerHTML = `<p class="text-center text-gray-500 p-6">Nenhum usuário cadastrado.</p>`; return; } const table = document.createElement('table'); table.className = 'w-full text-sm text-left'; table.innerHTML = `<thead class="bg-gray-100 text-xs text-gray-700 uppercase"><tr><th class="px-6 py-3">Funcionário</th><th class="px-6 py-3">Status Compra</th><th class="px-6 py-3">Ações</th></tr></thead><tbody></tbody>`; const tbody = table.querySelector('tbody'); users.forEach(u => { const row = document.createElement('tr'); row.className = 'bg-white border-b'; const isLocked = u.isLocked || false; row.innerHTML = `<td class="px-6 py-4 font-medium"><div class="font-bold">${u.name}</div><div class="text-gray-600">${u.email} / ${u.cpf}</div><div class="text-gray-500 text-xs">Função: ${u.role}</div></td><td class="px-6 py-4"><span class="px-2 py-1 text-xs font-semibold rounded-full ${isLocked ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">${isLocked ? 'Bloqueado' : 'Liberado'}</span></td><td class="px-6 py-4 space-x-2"><button data-id="${u.id}" class="toggle-user-lock-btn font-medium py-1 px-2 text-xs rounded ${isLocked ? 'bg-green-500 text-white' : 'bg-yellow-500 text-white'}">${isLocked ? 'Desbloquear' : 'Bloquear'}</button></td>`; tbody.appendChild(row); }); list.appendChild(table); } async function toggleUserLock(id) { const userRef = doc(db, 'users', id); const userSnap = await getDoc(userRef); if (userSnap.exists()) { await updateDoc(userRef, { isLocked: !userSnap.data().isLocked }); } } document.addEventListener('DOMContentLoaded', () => { if (sessionStorage.getItem('isAdminLoggedIn') !== 'true') { window.location.href = 'admin-login.html'; } const shopLockToggle = document.getElementById('shop-lock-toggle'); onSnapshot(settingsDoc, (doc) => { const isLocked = doc.exists() && doc.data().isLocked; shopLockToggle.checked = isLocked; updateShopLockStatus(isLocked); }); shopLockToggle.addEventListener('change', toggleShopLock); onSnapshot(productsCol, (snapshot) => { const products = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })); renderProducts(products); }); onSnapshot(usersCol, (snapshot) => { const users = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })); renderUsers(users); }); document.getElementById('product-form').addEventListener('submit', handleProductSubmit); document.getElementById('cancel-edit-btn').addEventListener('click', resetProductForm); document.getElementById('admin-product-list').addEventListener('click', e => { const button = e.target.closest('button'); if (!button) return; const id = button.dataset.id; if (button.matches('.edit-btn')) editProduct(id); if (button.matches('.delete-btn')) deleteProduct(id); if (button.matches('.toggle-hide-btn')) toggleProductVisibility(id); }); document.getElementById('admin-user-list').addEventListener('click', e => { const button = e.target.closest('button'); if (!button) return; const id = button.dataset.id; if (button.matches('.toggle-user-lock-btn')) toggleUserLock(id); }); });</script></body></html>